import{j as e,r as p,L as k,R as N}from"./react-vendor.CjFKJWOU.js";import{c as w}from"./state-vendor.RQj9JU5O.js";import{C as d}from"./Card.DLDyS9TF.js";import{C as _,a as L,b as S,P as R,f as E,p as C,d as $,e as M}from"./chart-vendor.Bws7AqQX.js";import{t as y}from"./index.js";import"./query-vendor.CB8uHlA8.js";import"./ui-vendor.B5WCADYB.js";const u="__mockforge/analytics",f=w((t,a)=>({summary:null,requests:null,endpoints:[],websocket:null,smtp:null,system:null,timeRange:"1h",isLoading:!1,error:null,lastUpdated:null,setTimeRange:s=>{t({timeRange:s}),a().fetchAll(s)},fetchSummary:async s=>{try{t({isLoading:!0,error:null});const r=await fetch(`/${u}/summary?range=${s}`);if(!r.ok)throw new Error(`Failed to fetch summary: ${r.statusText}`);const o=await r.json();t({summary:o.data,isLoading:!1,lastUpdated:new Date})}catch(r){const o=r instanceof Error?r.message:"Unknown error";t({error:o,isLoading:!1}),console.error("Failed to fetch summary:",r)}},fetchRequests:async s=>{try{t({isLoading:!0,error:null});const r=await fetch(`/${u}/requests?range=${s}`);if(!r.ok)throw new Error(`Failed to fetch requests: ${r.statusText}`);const o=await r.json();t({requests:o.data,isLoading:!1,lastUpdated:new Date})}catch(r){const o=r instanceof Error?r.message:"Unknown error";t({error:o,isLoading:!1}),console.error("Failed to fetch requests:",r)}},fetchEndpoints:async(s=10)=>{try{t({isLoading:!0,error:null});const r=await fetch(`/${u}/endpoints?limit=${s}`);if(!r.ok)throw new Error(`Failed to fetch endpoints: ${r.statusText}`);const o=await r.json();t({endpoints:o.data,isLoading:!1,lastUpdated:new Date})}catch(r){const o=r instanceof Error?r.message:"Unknown error";t({error:o,isLoading:!1}),console.error("Failed to fetch endpoints:",r)}},fetchWebSocket:async()=>{try{t({isLoading:!0,error:null});const s=await fetch(`/${u}/websocket`);if(!s.ok)throw new Error(`Failed to fetch WebSocket metrics: ${s.statusText}`);const r=await s.json();t({websocket:r.data,isLoading:!1,lastUpdated:new Date})}catch(s){const r=s instanceof Error?s.message:"Unknown error";t({error:r,isLoading:!1}),console.error("Failed to fetch WebSocket metrics:",s)}},fetchSmtp:async()=>{try{t({isLoading:!0,error:null});const s=await fetch(`/${u}/smtp`);if(!s.ok)throw new Error(`Failed to fetch SMTP metrics: ${s.statusText}`);const r=await s.json();t({smtp:r.data,isLoading:!1,lastUpdated:new Date})}catch(s){const r=s instanceof Error?s.message:"Unknown error";t({error:r,isLoading:!1}),console.error("Failed to fetch SMTP metrics:",s)}},fetchSystem:async()=>{try{t({isLoading:!0,error:null});const s=await fetch(`/${u}/system`);if(!s.ok)throw new Error(`Failed to fetch system metrics: ${s.statusText}`);const r=await s.json();t({system:r.data,isLoading:!1,lastUpdated:new Date})}catch(s){const r=s instanceof Error?s.message:"Unknown error";t({error:r,isLoading:!1}),console.error("Failed to fetch system metrics:",s)}},fetchAll:async s=>{const r=s||a().timeRange;t({isLoading:!0,error:null});try{await Promise.all([a().fetchSummary(r),a().fetchRequests(r),a().fetchEndpoints(),a().fetchWebSocket(),a().fetchSmtp(),a().fetchSystem()])}catch(o){const n=o instanceof Error?o.message:"Unknown error";t({error:n,isLoading:!1}),console.error("Failed to fetch analytics:",o)}},clearError:()=>t({error:null})}));setInterval(()=>{const t=f.getState();!t.isLoading&&!t.error&&t.fetchAll()},1e4);const U=({data:t,isLoading:a})=>{if(a||!t)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(r=>e.jsxs(d,{className:"p-6 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-24 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-16"})]},r))});const s=[{title:"Request Rate",value:t.request_rate.toFixed(1),unit:"req/s",color:"text-blue-600 dark:text-blue-400"},{title:"P95 Latency",value:Math.round(t.p95_latency_ms),unit:"ms",color:t.p95_latency_ms<100?"text-green-600 dark:text-green-400":t.p95_latency_ms<500?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"},{title:"Error Rate",value:t.error_rate_percent.toFixed(2),unit:"%",color:t.error_rate_percent<1?"text-green-600 dark:text-green-400":t.error_rate_percent<5?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"},{title:"Active Connections",value:Math.round(t.active_connections),unit:"",color:"text-purple-600 dark:text-purple-400"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:s.map(r=>e.jsxs(d,{className:"p-6",children:[e.jsx("div",{className:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:r.title}),e.jsxs("div",{className:`text-3xl font-bold ${r.color}`,children:[r.value,e.jsx("span",{className:"text-lg ml-1",children:r.unit})]})]},r.title))})};_.register(L,S,R,E,C,$,M);const T=({data:t,isLoading:a})=>{const s=p.useMemo(()=>{if(!t)return{labels:[],datasets:[]};const o=t.timestamps.map(i=>new Date(i*1e3).toLocaleTimeString()),n=[{border:"rgb(59, 130, 246)",bg:"rgba(59, 130, 246, 0.1)"},{border:"rgb(16, 185, 129)",bg:"rgba(16, 185, 129, 0.1)"},{border:"rgb(249, 115, 22)",bg:"rgba(249, 115, 22, 0.1)"},{border:"rgb(168, 85, 247)",bg:"rgba(168, 85, 247, 0.1)"},{border:"rgb(236, 72, 153)",bg:"rgba(236, 72, 153, 0.1)"}],m=t.series.map((i,c)=>({label:i.name,data:i.values,borderColor:n[c%n.length].border,backgroundColor:n[c%n.length].bg,borderWidth:2,pointRadius:2,pointHoverRadius:4,tension:.4}));return{labels:o,datasets:m}},[t]),r={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15}},title:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{x:{grid:{display:!1}},y:{beginAtZero:!0,title:{display:!0,text:"Requests per second"}}},interaction:{mode:"nearest",axis:"x",intersect:!1}};return a?e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Request Rate by Protocol"}),e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})]}):!t||t.series.length===0?e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Request Rate by Protocol"}),e.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500",children:"No data available"})]}):e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Request Rate by Protocol"}),e.jsx("div",{className:"h-64",children:e.jsx(k,{data:s,options:r})})]})},A=(t,a)=>{if(!t||t.length===0){console.warn("No data to export");return}const s=Object.keys(t[0]),r=[s.join(","),...t.map(i=>s.map(c=>{const l=i[c];return typeof l=="string"&&(l.includes(",")||l.includes('"'))?`"${l.replace(/"/g,'""')}"`:l}).join(","))].join(`
`),o=new Blob([r],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),m=URL.createObjectURL(o);n.setAttribute("href",m),n.setAttribute("download",a),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(m)},q=t=>{const a=new Date().toISOString().split("T")[0];A(t,`mockforge-endpoints-${a}.csv`)},F=(t,a)=>{const s=JSON.stringify(t,null,2),r=new Blob([s],{type:"application/json;charset=utf-8;"}),o=document.createElement("a"),n=URL.createObjectURL(r);o.setAttribute("href",n),o.setAttribute("download",a),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)},D=t=>{const a=new Date().toISOString().split("T")[0];F(t,`mockforge-analytics-${a}.json`)},P=({data:t,isLoading:a})=>{const[s,r]=p.useState("request_rate"),[o,n]=p.useState("desc"),m=N.useMemo(()=>t?[...t].sort((l,h)=>{const g=l[s],b=h[s];return o==="asc"?g>b?1:-1:g<b?1:-1}):[],[t,s,o]),i=l=>{s===l?n(o==="asc"?"desc":"asc"):(r(l),n("desc"))},c=({column:l})=>s!==l?e.jsx("span",{className:"text-gray-400",children:"↕"}):o==="asc"?e.jsx("span",{children:"↑"}):e.jsx("span",{children:"↓"});return a?e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Top Endpoints"}),e.jsx("div",{className:"animate-pulse space-y-3",children:[1,2,3,4,5].map(l=>e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"},l))})]}):!t||t.length===0?e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Top Endpoints"}),e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No endpoint data available"})]}):e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Top Endpoints"}),e.jsxs("button",{onClick:()=>q(t),className:"px-3 py-1.5 text-sm bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(y,{className:"w-4 h-4"}),"Export CSV"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Path"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Method"}),e.jsxs("th",{className:"text-right py-3 px-2 font-medium cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>i("request_rate"),children:["Req/s ",e.jsx(c,{column:"request_rate"})]}),e.jsxs("th",{className:"text-right py-3 px-2 font-medium cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>i("avg_latency_ms"),children:["Avg Latency ",e.jsx(c,{column:"avg_latency_ms"})]}),e.jsxs("th",{className:"text-right py-3 px-2 font-medium cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>i("p95_latency_ms"),children:["P95 ",e.jsx(c,{column:"p95_latency_ms"})]}),e.jsxs("th",{className:"text-right py-3 px-2 font-medium cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>i("error_rate_percent"),children:["Error % ",e.jsx(c,{column:"error_rate_percent"})]})]})}),e.jsx("tbody",{children:m.map((l,h)=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"py-3 px-2 font-mono text-xs",children:l.path}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${l.method==="GET"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":l.method==="POST"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":l.method==="PUT"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":l.method==="DELETE"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400"}`,children:l.method})}),e.jsx("td",{className:"py-3 px-2 text-right",children:l.request_rate.toFixed(1)}),e.jsxs("td",{className:"py-3 px-2 text-right",children:[Math.round(l.avg_latency_ms),"ms"]}),e.jsxs("td",{className:`py-3 px-2 text-right ${l.p95_latency_ms<100?"text-green-600 dark:text-green-400":l.p95_latency_ms<500?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:[Math.round(l.p95_latency_ms),"ms"]}),e.jsxs("td",{className:`py-3 px-2 text-right ${l.error_rate_percent<1?"text-green-600 dark:text-green-400":l.error_rate_percent<5?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:[l.error_rate_percent.toFixed(2),"%"]})]},`${l.path}-${l.method}-${h}`))})]})})]})},O=({data:t,isLoading:a})=>{if(a||!t)return e.jsxs(d,{className:"p-6 animate-pulse",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"WebSocket Metrics"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(r=>e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded"},r))})]});const s=[{label:"Active Connections",value:Math.round(t.active_connections),color:"text-blue-600 dark:text-blue-400"},{label:"Total Connections",value:Math.round(t.total_connections),color:"text-gray-600 dark:text-gray-400"},{label:"Messages Sent/s",value:t.message_rate_sent.toFixed(1),color:"text-green-600 dark:text-green-400"},{label:"Messages Received/s",value:t.message_rate_received.toFixed(1),color:"text-purple-600 dark:text-purple-400"},{label:"Error Rate",value:t.error_rate.toFixed(2),color:t.error_rate<.1?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"},{label:"Avg Connection Duration",value:`${Math.round(t.avg_connection_duration_seconds)}s`,color:"text-gray-600 dark:text-gray-400"}];return e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"WebSocket Metrics"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:s.map(r=>e.jsxs("div",{className:"border-b border-gray-100 dark:border-gray-800 pb-2",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.label}),e.jsx("div",{className:`text-2xl font-semibold ${r.color}`,children:r.value})]},r.label))})]})},W=t=>{const a=Math.floor(t/86400),s=Math.floor(t%86400/3600),r=Math.floor(t%3600/60);return a>0?`${a}d ${s}h`:s>0?`${s}h ${r}m`:`${r}m`},B=({data:t,isLoading:a})=>{if(a||!t)return e.jsxs(d,{className:"p-6 animate-pulse",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"System Health"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(r=>e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded"},r))})]});const s=[{label:"Memory Usage",value:`${Math.round(t.memory_usage_mb)} MB`,color:"text-blue-600 dark:text-blue-400"},{label:"CPU Usage",value:`${t.cpu_usage_percent.toFixed(1)}%`,color:t.cpu_usage_percent<50?"text-green-600 dark:text-green-400":t.cpu_usage_percent<80?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"},{label:"Thread Count",value:Math.round(t.thread_count),color:"text-purple-600 dark:text-purple-400"},{label:"Uptime",value:W(t.uptime_seconds),color:"text-gray-600 dark:text-gray-400"}];return e.jsxs(d,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"System Health"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:s.map(r=>e.jsxs("div",{className:"border-b border-gray-100 dark:border-gray-800 pb-2",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.label}),e.jsx("div",{className:`text-2xl font-semibold ${r.color}`,children:r.value})]},r.label))})]})},Z=()=>{const t=f(),{summary:a,requests:s,endpoints:r,websocket:o,smtp:n,system:m,timeRange:i,isLoading:c,error:l,setTimeRange:h,fetchAll:g,clearError:b}=t,j=()=>{const x={summary:a,requests:s,endpoints:r,websocket:o,smtp:n,system:m,timeRange:i,exportedAt:new Date().toISOString()};D(x)};p.useEffect(()=>{g()},[g]);const v=[{value:"5m",label:"Last 5 minutes"},{value:"15m",label:"Last 15 minutes"},{value:"1h",label:"Last hour"},{value:"6h",label:"Last 6 hours"},{value:"24h",label:"Last 24 hours"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Analytics"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Real-time metrics and performance insights"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"Time Range:"}),e.jsx("select",{value:i,onChange:x=>h(x.target.value),className:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-blue-500 focus:outline-none",children:v.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))}),e.jsx("button",{onClick:()=>g(),disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Refreshing...":"Refresh"}),e.jsxs("button",{onClick:j,disabled:c||!a,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),"Export All"]})]})]}),l&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 dark:text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-red-800 dark:text-red-200",children:l})]}),e.jsx("button",{onClick:b,className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200",children:"Dismiss"})]}),e.jsx(U,{data:a,isLoading:c}),e.jsx(T,{data:s,isLoading:c}),e.jsx(P,{data:r,isLoading:c}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(O,{data:o,isLoading:c}),e.jsx(B,{data:m,isLoading:c})]}),!c&&a&&e.jsxs("div",{className:"text-center text-sm text-gray-500 dark:text-gray-400",children:["Last updated: ",new Date(a.timestamp).toLocaleString()]})]})};export{Z as AnalyticsPage,Z as default};
