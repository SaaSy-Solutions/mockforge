import{r as c,R as A,j as e}from"./react-vendor.CjFKJWOU.js";import{i as C,P as u,E as f,F as v,A as R,f as h,R as _,t as M,n as N,M as k,s as F,j as O,e as q,v as D,l as I}from"./index.js";import"./chart-vendor.Bws7AqQX.js";import"./query-vendor.CB8uHlA8.js";import"./ui-vendor.B5WCADYB.js";import"./state-vendor.RQj9JU5O.js";const U={GET:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",POST:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400",PUT:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400",DELETE:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",PATCH:"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-400",HEAD:"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400",OPTIONS:"bg-indigo-100 text-indigo-800 dark:bg-indigo-900/20 dark:text-indigo-400"};function H(r){return r>=200&&r<300?"success":r>=400&&r<500?"warning":r>=500?"error":"info"}function $(r){return new Date(r).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"})}function K(){const[r,p]=c.useState(""),[x,w]=c.useState("ALL"),[a,S]=c.useState("all"),[g,T]=c.useState(100),[y,j]=c.useState(50),{data:s,isLoading:L,error:m,refetch:E}=C({method:x==="ALL"?void 0:x,path:r||void 0,limit:g});A.useEffect(()=>{j(50)},[r,x,a,g]);const i=c.useMemo(()=>{if(!s)return[];let t=s;if(a!=="all"){const o=a==="2xx"?200:a==="4xx"?400:500,l=o+99;t=t.filter(n=>n.status_code>=o&&n.status_code<=l)}return t.slice(0,y)},[s,y,a]),b=c.useMemo(()=>{if(!s)return!1;let t=s;if(a!=="all"){const o=a==="2xx"?200:a==="4xx"?400:500,l=o+99;t=t.filter(n=>n.status_code>=o&&n.status_code<=l)}return i.length<t.length},[s,i.length,a]),P=()=>{if(i.length)try{const t=[["Timestamp","Method","Path","Status Code","Response Time (ms)","Client IP","User Agent"].join(","),...i.map(d=>[d.timestamp,d.method,`"${d.path}"`,d.status_code,d.response_time_ms,d.client_ip||"",`"${d.user_agent||""}"`].join(","))].join(`
`),o=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),n=URL.createObjectURL(o);l.setAttribute("href",n),l.setAttribute("download",`mockforge-logs-${new Date().toISOString().split("T")[0]}.csv`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)}catch(t){I.error("Failed to export logs",t),alert("Failed to export logs. Please try again.")}};return L?e.jsxs("div",{className:"space-y-8",children:[e.jsx(u,{title:"Request Logs",subtitle:"Monitor and analyze API requests"}),e.jsx(f,{icon:e.jsx(v,{className:"h-12 w-12"}),title:"Loading logs...",description:"Fetching recent request data from the server."})]}):m?e.jsxs("div",{className:"space-y-8",children:[e.jsx(u,{title:"Request Logs",subtitle:"Monitor and analyze API requests"}),e.jsx(R,{type:"error",title:"Failed to load logs",message:m instanceof Error?m.message:"Unable to fetch request logs. Please try again."})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsx(u,{title:"Request Logs",subtitle:"Monitor and analyze API requests in real-time",action:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>E(),className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Refresh"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:P,disabled:!i.length,className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Export CSV"]})]})}),e.jsx(N,{title:"Filters & Search",subtitle:"Refine your log view with advanced filtering options",children:e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Search Path"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(O,{placeholder:"Filter by path...",value:r,onChange:t=>p(t.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"HTTP Method"}),e.jsxs("select",{value:x,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ALL",children:"All Methods"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"PATCH",children:"PATCH"}),e.jsx("option",{value:"HEAD",children:"HEAD"}),e.jsx("option",{value:"OPTIONS",children:"OPTIONS"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status Code"}),e.jsxs("select",{value:a,onChange:t=>S(t.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"2xx",children:"2xx Success"}),e.jsx("option",{value:"4xx",children:"4xx Client Error"}),e.jsx("option",{value:"5xx",children:"5xx Server Error"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Fetch Limit"}),e.jsxs("select",{value:g,onChange:t=>T(Number(t.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:250,children:"250"}),e.jsx("option",{value:500,children:"500"}),e.jsx("option",{value:1e3,children:"1000"})]})]})]})})}),e.jsx(N,{title:`Request Logs (${i.length})`,subtitle:`Showing ${i.length} of ${(s==null?void 0:s.length)||0} loaded requests${b?" • More available":""}`,children:e.jsx(k,{children:i.length===0?e.jsx(f,{icon:e.jsx(v,{className:"h-12 w-12"}),title:"No logs found",description:(s==null?void 0:s.length)===0?"No request logs are available. Make some API calls to see data here.":"No logs match your current filters. Try adjusting your search criteria."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:i.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-semibold ${U[t.method]||"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400"}`,children:t.method}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-mono text-sm text-gray-900 dark:text-gray-100 truncate",children:t.path}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[$(t.timestamp),t.client_ip&&e.jsxs("span",{className:"ml-2",children:["• ",t.client_ip]})]}),t.user_agent&&e.jsx("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 truncate",children:t.user_agent})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:[t.response_time_ms,"ms"]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Response Time"})]}),e.jsx(q,{variant:H(t.status_code),size:"sm",children:t.status_code})]})]},t.id))}),b&&e.jsx("div",{className:"flex justify-center pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs(h,{variant:"outline",onClick:()=>j(t=>t+50),className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Show more logs (",((s==null?void 0:s.length)||0)-i.length," remaining)"]})})]})})})]})}export{K as LogsPage};
